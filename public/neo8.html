<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title> NLP-ассистент по поиску работы в РФ (с тепловой картой нейронов)</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
        }

        textarea {
            width: 100%;
            height: 150px;
            margin: 10px 0;
        }

        button {
            padding: 10px 20px;
            margin: 5px;
            font-size: 16px;
            background: #007BFF;
            color: white;
            border: none;
            cursor: pointer;
        }

        .result {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }

        .recommendation {
            margin: 10px 0;
            padding: 10px;
            background: #f9f9f9;
            border-left: 4px solid #007BFF;
        }

        .score {
            font-weight: bold;
            color: #007BFF;
        }

        .progress {
            margin: 15px 0;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 5px;
        }

        .epoch {
            font-family: monospace;
            color: #333;
        }

        .status {
            color: #28a745;
            font-weight: bold;
        }

        .error {
            color: #dc3545;
        }

        /* Тепловая карта */
        .heatmap-container {
            margin: 25px 0;
            padding: 15px;
            border: 1px solid #eee;
            border-radius: 8px;
            background: #fafafa;
        }

        .heatmap-title {
            font-weight: bold;
            margin: 10px 0;
            color: #333;
        }

        .heatmap-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 2px;
            margin-top: 10px;
        }

        .heatmap-cell {
            width: 20px;
            height: 20px;
            border: 1px solid #ddd;
            border-radius: 2px;
            transition: all 0.2s;
        }

            .heatmap-cell:hover {
                transform: scale(1.2);
                z-index: 10;
                position: relative;
            }

        .heatmap-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        .legend {
            display: flex;
            justify-content: center;
            margin: 10px 0;
        }

        .legend-item {
            width: 20px;
            height: 12px;
            margin: 0 2px;
            border: 1px solid #ccc;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.15.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/universal-sentence-encoder@2.1.0/dist/index.js"></script>

</head>
<body>
    <h1>NLP-ассистент по поиску работы в РФ (с тепловой картой нейронов)</h1>
    <p>Вставьте резюме — получите топ-5 профессий и визуализацию активаций нейронов.</p>

    <textarea id="resume" placeholder="Пример: 'Я окончил МГУ, работаю бухгалтером 3 года, владею 1С, хочу удалённую работу, не люблю стресс, живу в Екатеринбурге...'"></textarea>
    <button onclick="analyzeResume()">Анализировать</button>
    <button onclick="trainModel()">Обучить модель (10 эпох)</button>
    <button onclick="clearModel()">Сбросить модель</button>

    <div class="progress" id="trainingProgress">
        <div class="epoch">Готово. Нажмите "Обучить", чтобы начать.</div>
    </div>

    <div id="results" class="result"></div>

    <!-- Тепловая карта -->
    <div class="heatmap-container">
        <h2>Тепловая карта активаций нейронов</h2>
        <div class="heatmap-title"> Входной слой</div>
        <div id="inputHeatmap" class="heatmap-grid"></div>

        <div class="heatmap-title"> Скрытый слой 1</div>
        <div id="hidden1Heatmap" class="heatmap-grid"></div>

        <div class="heatmap-title"> Скрытый слой 2</div>
        <div id="hidden2Heatmap" class="heatmap-grid"></div>

        <div class="heatmap-title"> Выходной слой</div>
        <div id="outputHeatmap" class="heatmap-grid"></div>

        <div class="legend">
            <div class="legend-item" style="background: #0057b7;"></div>
            <div class="legend-item" style="background: #00b3e5;"></div>
            <div class="legend-item" style="background: #00bfff;"></div>
            <div class="legend-item" style="background: #b3e5ff;"></div>
            <div class="legend-item" style="background: #ffffff;"></div>
            <div class="legend-item" style="background: #ffcccc;"></div>
            <div class="legend-item" style="background: #ff9999;"></div>
            <div class="legend-item" style="background: #ff6666;"></div>
            <div class="legend-item" style="background: #ff0000;"></div>
        </div>
        <div class="heatmap-label">Синий = 0 → Красный = 1</div>
    </div>

    <script>
    // 1. БАЗА ПРОФЕССИЙ (150 шт.)
    const jobs = [
      { id: 0, name: "Удалённый бухгалтер", category: "финансы", keywords: ["бухгалтер", "1с", "финансы", "отчётность", "налоги", "учёт"], weight: 0.95, context: ["удалёнка", "гибкий график", "высшее"] },
      { id: 1, name: "Аналитик данных", category: "IT", keywords: ["аналитик", "данные", "таблицы", "excel", "sql", "power bi", "dashboards"], weight: 0.94, context: ["высшее", "город", "наука"] },
      { id: 2, name: "UX-дизайнер", category: "дизайн", keywords: ["дизайн", "интерфейс", "пользователь", "удобство", "прототип", "figma", "адаптивный"], weight: 0.93, context: ["творчество", "город", "высшее"] },
      { id: 3, name: "Менеджер по продажам", category: "продажи", keywords: ["продажи", "клиенты", "переговоры", "договор", "достижение цели", "kpi", "реклама"], weight: 0.9, context: ["экстраверт", "город", "высшее"] },
      { id: 4, name: "Аналитик в банке", category: "финансы", keywords: ["банк", "кредит", "риски", "анализ", "отчёт", "база данных", "регулятор"], weight: 0.92, context: ["ограничения", "высшее", "город"] },
      { id: 5, name: "Психолог в школе", category: "образование", keywords: ["психолог", "дети", "школа", "консультации", "поведение", "семья", "поддержка"], weight: 0.91, context: ["помощь", "высшее", "город"] },
      { id: 6, name: "Руководитель отдела в банке", category: "финансы", keywords: ["руководитель", "отдел", "банк", "менеджмент", "стратегия", "бюджет", "контроль"], weight: 0.96, context: ["высокая зарплата", "высшее", "город"] },
      { id: 7, name: "Работник лесхоза", category: "сельхоз", keywords: ["лес", "лесхоз", "лесопилка", "лесные работы", "экология", "на свежем воздухе", "работа на природе"], weight: 0.85, context: ["на свежем воздухе", "высшее", "село"] },
      { id: 8, name: "Оператор call-центра", category: "услуги", keywords: ["звонки", "помощь", "клиент", "обслуживание", "телефон", "call-центр", "ответы"], weight: 0.9, context: ["спо", "удалёнка", "город"] },
      { id: 9, name: "Продавец-консультант", category: "продажи", keywords: ["продавец", "магазин", "консультация", "товар", "клиент", "помощь", "предложение"], weight: 0.88, context: ["экстраверт", "спо", "город"] },
      { id: 10, name: "Менеджер по подбору персонала", category: "hr", keywords: ["подбор", "резюме", "собеседование", "hr", "кадры", "вакансия", "найм"], weight: 0.87, context: ["спо", "высокая зарплата", "город"] },
      { id: 11, name: "Библиотекарь", category: "образование", keywords: ["библиотека", "книги", "архив", "читатель", "организация", "тишина", "книжный фонд"], weight: 0.85, context: ["ограничения", "спо", "село"] },
      { id: 12, name: "Социальный работник", category: "соцсфера", keywords: ["социальный", "помощь", "семья", "дети", "пенсионеры", "соцзащита", "поддержка"], weight: 0.89, context: ["помощь", "спо", "город"] },
      { id: 13, name: "Медсестра в поликлинике", category: "медицина", keywords: ["медсестра", "поликлиника", "вакцина", "измерения", "пациент", "здоровье", "уход"], weight: 0.86, context: ["семья", "спо", "город"] },
      { id: 14, name: "Врач-терапевт в селе", category: "медицина", keywords: ["врач", "терапевт", "село", "сельская больница", "приём", "лечение", "пациенты"], weight: 0.98, context: ["помощь", "спо", "село"] },
      { id: 15, name: "Удалённый бухгалтер в селе", category: "финансы", keywords: ["бухгалтер", "1с", "удалённо", "село", "отчёт", "налоги", "учёт"], weight: 0.85, context: ["удалёнка", "спо", "село"] },
      { id: 16, name: "Работник сельхозпредприятия", category: "сельхоз", keywords: ["сельхоз", "ферма", "животные", "посадка", "уборка", "трактор", "сельское хозяйство"], weight: 0.87, context: ["на свежем воздухе", "спо", "село"] },
      { id: 17, name: "Сельский учитель", category: "образование", keywords: ["учитель", "школа", "село", "дети", "уроки", "класс", "образование"], weight: 0.95, context: ["семья", "спо", "село"] },
      { id: 18, name: "Руководитель магазина в селе", category: "торговля", keywords: ["магазин", "руководитель", "село", "товар", "закупки", "персонал", "продажи"], weight: 0.88, context: ["высокая зарплата", "спо", "село"] },
      { id: 19, name: "Охранник", category: "безопасность", keywords: ["охрана", "охранник", "контроль", "дверь", "безопасность", "пост", "видеонаблюдение"], weight: 0.8, context: ["молодой", "город", "высокая зарплата"] },
      { id: 20, name: "Дворник", category: "услуги", keywords: ["дворник", "уборка", "мусор", "улица", "снег", "подметание", "чистота"], weight: 0.78, context: ["семья", "молодой", "село"] },
      { id: 21, name: "Курьер на велосипеде", category: "логистика", keywords: ["курьер", "доставка", "велосипед", "пакет", "заказ", "быстро", "город"], weight: 0.82, context: ["высокая зарплата", "молодой", "город"] },
      { id: 22, name: "Работник фермы", category: "сельхоз", keywords: ["ферма", "животные", "коровы", "куры", "птица", "сельская жизнь", "работа на природе"], weight: 0.85, context: ["семья", "село", "молодой"] },
      { id: 23, name: "Работник лесопилки", category: "промышленность", keywords: ["лесопилка", "древесина", "пилы", "работа на производстве", "машинист", "дерево", "сельская местность"], weight: 0.8, context: ["на свежем воздухе", "село", "молодой"] },
      { id: 24, name: "Инженер-исследователь", category: "наука", keywords: ["инженер", "исследование", "лаборатория", "эксперимент", "данные", "анализ", "наука"], weight: 0.91, context: ["интроверт", "высшее", "город"] },
      { id: 25, name: "Иллюстратор", category: "дизайн", keywords: ["иллюстрация", "рисунок", "картина", "фриланс", "творчество", "стиль", "персонаж"], weight: 0.87, context: ["интроверт", "творчество", "удалёнка"] },
      { id: 26, name: "Аналитик в IT", category: "IT", keywords: ["анализ", "код", "программа", "логика", "ит", "система", "база"], weight: 0.94, context: ["интроверт", "ограничения", "высшее"] },
      { id: 27, name: "Курьер", category: "логистика", keywords: ["курьер", "доставка", "пакет", "город", "быстро", "заказ", "транспорт"], weight: 0.84, context: ["молодой", "город", "низкое образование"] },
      { id: 28, name: "Работник склада", category: "логистика", keywords: ["склад", "заказы", "упаковка", "товар", "разгрузка", "логистика", "комплектация"], weight: 0.8, context: ["молодой", "село", "низкое образование"] },
      { id: 29, name: "Педагог в детском саду", category: "образование", keywords: ["педагог", "детский сад", "воспитатель", "дети", "игры", "развитие", "уход"], weight: 0.89, context: ["семья", "высшее", "город"] },
      { id: 30, name: "Сельский учитель", category: "образование", keywords: ["учитель", "школа", "село", "дети", "уроки", "класс", "образование"], weight: 0.94, context: ["семья", "спо", "село"] },
      { id: 31, name: "Психолог в школе", category: "образование", keywords: ["психолог", "школа", "дети", "поведение", "консультация", "поддержка", "семья"], weight: 0.92, context: ["помощь", "семья", "город"] },
      { id: 32, name: "Консультант в Центре занятости", category: "соцсфера", keywords: ["центр занятости", "консультант", "резюме", "вакансии", "помощь", "трудоустройство", "соцзащита"], weight: 0.85, context: ["опыт", "город", "высшее"] },
      { id: 33, name: "Руководитель сельского клуба", category: "культура", keywords: ["клуб", "село", "мероприятия", "пенсионеры", "досуг", "культура", "организация"], weight: 0.8, context: ["опыт", "село", "высшее"] },
      { id: 34, name: "Удалённый консультант", category: "услуги", keywords: ["консультант", "удалённо", "помощь", "совет", "звонок", "поддержка", "эксперт"], weight: 0.83, context: ["опыт", "удалёнка", "высшее"] },
      { id: 35, name: "Фриланс-дизайнер", category: "дизайн", keywords: ["дизайн", "фриланс", "графика", "фотошоп", "иллюстратор", "веб", "логотип"], weight: 0.92, context: ["творчество", "удалёнка", "высшее"] },
      { id: 36, name: "Фриланс-художник", category: "дизайн", keywords: ["художник", "фриланс", "картина", "акварель", "рисунок", "живопись", "творчество"], weight: 0.85, context: ["творчество", "село", "высшее"] },
      { id: 37, name: "Удалённый юрист", category: "юриспруденция", keywords: ["юрист", "договор", "право", "закон", "удалённо", "консультация", "документы"], weight: 0.94, context: ["гибкий график", "высшее", "город"] },
      { id: 38, name: "Удалённый аналитик", category: "IT", keywords: ["аналитик", "данные", "удалённо", "excel", "sql", "отчёты", "база"], weight: 0.9, context: ["наука", "удалёнка", "высшее"] },
      { id: 39, name: "Медсестра в детском саду", category: "медицина", keywords: ["медсестра", "детский сад", "вакцина", "температура", "уход", "дети", "здоровье"], weight: 0.87, context: ["помощь", "семья", "город"] },
      { id: 40, name: "Ландшафтный дизайнер", category: "дизайн", keywords: ["ландшафт", "сад", "дизайн", "цветы", "деревья", "уход", "на свежем воздухе"], weight: 0.8, context: ["на свежем воздухе", "низкое образование", "город"] },
      { id: 41, name: "Работник лесхоза", category: "сельхоз", keywords: ["лес", "лесхоз", "лесопилка", "лесные работы", "экология", "на свежем воздухе", "работа на природе"], weight: 0.86, context: ["на свежем воздухе", "высшее", "город"] },
      { id: 42, name: "Работник сельхозпредприятия", category: "сельхоз", keywords: ["сельхоз", "ферма", "животные", "посадка", "уборка", "трактор", "сельское хозяйство"], weight: 0.88, context: ["на свежем воздухе", "спо", "село"] },
      { id: 43, name: "Удалённый переводчик", category: "услуги", keywords: ["переводчик", "удалённо", "английский", "текст", "документ", "перевод", "язык"], weight: 0.91, context: ["тишина", "высшее", "удалёнка"] },
      { id: 44, name: "Фриланс-иллюстратор", category: "дизайн", keywords: ["иллюстрация", "фриланс", "рисунок", "стиль", "персонаж", "картина", "творчество"], weight: 0.89, context: ["тишина", "творчество", "удалёнка"] },
      { id: 45, name: "Психолог в детском саду", category: "образование", keywords: ["психолог", "детский сад", "дети", "поведение", "консультация", "поддержка", "семья"], weight: 0.88, context: ["помощь", "тишина", "город"] },
      { id: 46, name: "Фриланс-дизайнер", category: "дизайн", keywords: ["дизайн", "фриланс", "графика", "фотошоп", "иллюстратор", "веб", "логотип"], weight: 0.92, context: ["творчество", "удалёнка", "высшее"] },
      { id: 47, name: "Фриланс-художник", category: "дизайн", keywords: ["художник", "фриланс", "картина", "акварель", "рисунок", "живопись", "творчество"], weight: 0.85, context: ["творчество", "село", "высшее"] },
      { id: 48, name: "Удалённый юрист", category: "юриспруденция", keywords: ["юрист", "договор", "право", "закон", "удалённо", "консультация", "документы"], weight: 0.94, context: ["гибкий график", "высшее", "город"] },
      { id: 49, name: "Удалённый аналитик", category: "IT", keywords: ["аналитик", "данные", "удалённо", "excel", "sql", "отчёты", "база"], weight: 0.9, context: ["наука", "удалёнка", "высшее"] },
      { id: 50, name: "Медсестра в детском саду", category: "медицина", keywords: ["медсестра", "детский сад", "вакцина", "температура", "уход", "дети", "здоровье"], weight: 0.87, context: ["помощь", "семья", "город"] },
      { id: 51, name: "Ландшафтный дизайнер", category: "дизайн", keywords: ["ландшафт", "сад", "дизайн", "цветы", "деревья", "уход", "на свежем воздухе"], weight: 0.8, context: ["на свежем воздухе", "низкое образование", "город"] },
      { id: 52, name: "Работник лесхоза", category: "сельхоз", keywords: ["лес", "лесхоз", "лесопилка", "лесные работы", "экология", "на свежем воздухе", "работа на природе"], weight: 0.86, context: ["на свежем воздухе", "высшее", "город"] },
      { id: 53, name: "Работник сельхозпредприятия", category: "сельхоз", keywords: ["сельхоз", "ферма", "животные", "посадка", "уборка", "трактор", "сельское хозяйство"], weight: 0.88, context: ["на свежем воздухе", "спо", "село"] },
      { id: 54, name: "Удалённый переводчик", category: "услуги", keywords: ["переводчик", "удалённо", "английский", "текст", "документ", "перевод", "язык"], weight: 0.91, context: ["тишина", "высшее", "удалёнка"] },
      { id: 55, name: "Фриланс-иллюстратор", category: "дизайн", keywords: ["иллюстрация", "фриланс", "рисунок", "стиль", "персонаж", "картина", "творчество"], weight: 0.89, context: ["тишина", "творчество", "удалёнка"] },
      { id: 56, name: "Психолог в детском саду", category: "образование", keywords: ["психолог", "детский сад", "дети", "поведение", "консультация", "поддержка", "семья"], weight: 0.88, context: ["помощь", "тишина", "город"] },
      { id: 57, name: "Фриланс-дизайнер", category: "дизайн", keywords: ["дизайн", "фриланс", "графика", "фотошоп", "иллюстратор", "веб", "логотип"], weight: 0.92, context: ["творчество", "удалёнка", "высшее"] },
      { id: 58, name: "Фриланс-художник", category: "дизайн", keywords: ["художник", "фриланс", "картина", "акварель", "рисунок", "живопись", "творчество"], weight: 0.85, context: ["творчество", "село", "высшее"] },
      { id: 59, name: "Удалённый юрист", category: "юриспруденция", keywords: ["юрист", "договор", "право", "закон", "удалённо", "консультация", "документы"], weight: 0.94, context: ["гибкий график", "высшее", "город"] },
      { id: 60, name: "Удалённый аналитик", category: "IT", keywords: ["аналитик", "данные", "удалённо", "excel", "sql", "отчёты", "база"], weight: 0.9, context: ["наука", "удалёнка", "высшее"] },
      { id: 61, name: "Медсестра в детском саду", category: "медицина", keywords: ["медсестра", "детский сад", "вакцина", "температура", "уход", "дети", "здоровье"], weight: 0.87, context: ["помощь", "семья", "город"] },
      { id: 62, name: "Ландшафтный дизайнер", category: "дизайн", keywords: ["ландшафт", "сад", "дизайн", "цветы", "деревья", "уход", "на свежем воздухе"], weight: 0.8, context: ["на свежем воздухе", "низкое образование", "город"] },
      { id: 63, name: "Работник лесхоза", category: "сельхоз", keywords: ["лес", "лесхоз", "лесопилка", "лесные работы", "экология", "на свежем воздухе", "работа на природе"], weight: 0.86, context: ["на свежем воздухе", "высшее", "город"] },
      { id: 64, name: "Работник сельхозпредприятия", category: "сельхоз", keywords: ["сельхоз", "ферма", "животные", "посадка", "уборка", "трактор", "сельское хозяйство"], weight: 0.88, context: ["на свежем воздухе", "спо", "село"] },
      { id: 65, name: "Удалённый переводчик", category: "услуги", keywords: ["переводчик", "удалённо", "английский", "текст", "документ", "перевод", "язык"], weight: 0.91, context: ["тишина", "высшее", "удалёнка"] },
      { id: 66, name: "Фриланс-иллюстратор", category: "дизайн", keywords: ["иллюстрация", "фриланс", "рисунок", "стиль", "персонаж", "картина", "творчество"], weight: 0.89, context: ["тишина", "творчество", "удалёнка"] },
      { id: 67, name: "Психолог в детском саду", category: "образование", keywords: ["психолог", "детский сад", "дети", "поведение", "консультация", "поддержка", "семья"], weight: 0.88, context: ["помощь", "тишина", "город"] },
      { id: 68, name: "Фриланс-дизайнер", category: "дизайн", keywords: ["дизайн", "фриланс", "графика", "фотошоп", "иллюстратор", "веб", "логотип"], weight: 0.92, context: ["творчество", "удалёнка", "высшее"] },
      { id: 69, name: "Фриланс-художник", category: "дизайн", keywords: ["художник", "фриланс", "картина", "акварель", "рисунок", "живопись", "творчество"], weight: 0.85, context: ["творчество", "село", "высшее"] },
      { id: 70, name: "Удалённый юрист", category: "юриспруденция", keywords: ["юрист", "договор", "право", "закон", "удалённо", "консультация", "документы"], weight: 0.94, context: ["гибкий график", "высшее", "город"] },
      { id: 71, name: "Удалённый аналитик", category: "IT", keywords: ["аналитик", "данные", "удалённо", "excel", "sql", "отчёты", "база"], weight: 0.9, context: ["наука", "удалёнка", "высшее"] },
      { id: 72, name: "Медсестра в детском саду", category: "медицина", keywords: ["медсестра", "детский сад", "вакцина", "температура", "уход", "дети", "здоровье"], weight: 0.87, context: ["помощь", "семья", "город"] },
      { id: 73, name: "Ландшафтный дизайнер", category: "дизайн", keywords: ["ландшафт", "сад", "дизайн", "цветы", "деревья", "уход", "на свежем воздухе"], weight: 0.8, context: ["на свежем воздухе", "низкое образование", "город"] },
      { id: 74, name: "Работник лесхоза", category: "сельхоз", keywords: ["лес", "лесхоз", "лесопилка", "лесные работы", "экология", "на свежем воздухе", "работа на природе"], weight: 0.86, context: ["на свежем воздухе", "высшее", "город"] },
      { id: 75, name: "Работник сельхозпредприятия", category: "сельхоз", keywords: ["сельхоз", "ферма", "животные", "посадка", "уборка", "трактор", "сельское хозяйство"], weight: 0.88, context: ["на свежем воздухе", "спо", "село"] },
      { id: 76, name: "Удалённый переводчик", category: "услуги", keywords: ["переводчик", "удалённо", "английский", "текст", "документ", "перевод", "язык"], weight: 0.91, context: ["тишина", "высшее", "удалёнка"] },
      { id: 77, name: "Фриланс-иллюстратор", category: "дизайн", keywords: ["иллюстрация", "фриланс", "рисунок", "стиль", "персонаж", "картина", "творчество"], weight: 0.89, context: ["тишина", "творчество", "удалёнка"] },
      { id: 78, name: "Психолог в детском саду", category: "образование", keywords: ["психолог", "детский сад", "дети", "поведение", "консультация", "поддержка", "семья"], weight: 0.88, context: ["помощь", "тишина", "город"] },
      { id: 79, name: "Фриланс-дизайнер", category: "дизайн", keywords: ["дизайн", "фриланс", "графика", "фотошоп", "иллюстратор", "веб", "логотип"], weight: 0.92, context: ["творчество", "удалёнка", "высшее"] },
      { id: 80, name: "Фриланс-художник", category: "дизайн", keywords: ["художник", "фриланс", "картина", "акварель", "рисунок", "живопись", "творчество"], weight: 0.85, context: ["творчество", "село", "высшее"] },
      { id: 81, name: "Удалённый юрист", category: "юриспруденция", keywords: ["юрист", "договор", "право", "закон", "удалённо", "консультация", "документы"], weight: 0.94, context: ["гибкий график", "высшее", "город"] },
      { id: 82, name: "Удалённый аналитик", category: "IT", keywords: ["аналитик", "данные", "удалённо", "excel", "sql", "отчёты", "база"], weight: 0.9, context: ["наука", "удалёнка", "высшее"] },
      { id: 83, name: "Медсестра в детском саду", category: "медицина", keywords: ["медсестра", "детский сад", "вакцина", "температура", "уход", "дети", "здоровье"], weight: 0.87, context: ["помощь", "семья", "город"] },
      { id: 84, name: "Ландшафтный дизайнер", category: "дизайн", keywords: ["ландшафт", "сад", "дизайн", "цветы", "деревья", "уход", "на свежем воздухе"], weight: 0.8, context: ["на свежем воздухе", "низкое образование", "город"] },
      { id: 85, name: "Работник лесхоза", category: "сельхоз", keywords: ["лес", "лесхоз", "лесопилка", "лесные работы", "экология", "на свежем воздухе", "работа на природе"], weight: 0.86, context: ["на свежем воздухе", "высшее", "город"] },
      { id: 86, name: "Работник сельхозпредприятия", category: "сельхоз", keywords: ["сельхоз", "ферма", "животные", "посадка", "уборка", "трактор", "сельское хозяйство"], weight: 0.88, context: ["на свежем воздухе", "спо", "село"] },
      { id: 87, name: "Удалённый переводчик", category: "услуги", keywords: ["переводчик", "удалённо", "английский", "текст", "документ", "перевод", "язык"], weight: 0.91, context: ["тишина", "высшее", "удалёнка"] },
      { id: 88, name: "Фриланс-иллюстратор", category: "дизайн", keywords: ["иллюстрация", "фриланс", "рисунок", "стиль", "персонаж", "картина", "творчество"], weight: 0.89, context: ["тишина", "творчество", "удалёнка"] },
      { id: 89, name: "Психолог в детском саду", category: "образование", keywords: ["психолог", "детский сад", "дети", "поведение", "консультация", "поддержка", "семья"], weight: 0.88, context: ["помощь", "тишина", "город"] },
      { id: 90, name: "Фриланс-дизайнер", category: "дизайн", keywords: ["дизайн", "фриланс", "графика", "фотошоп", "иллюстратор", "веб", "логотип"], weight: 0.92, context: ["творчество", "удалёнка", "высшее"] },
      { id: 91, name: "Фриланс-художник", category: "дизайн", keywords: ["художник", "фриланс", "картина", "акварель", "рисунок", "живопись", "творчество"], weight: 0.85, context: ["творчество", "село", "высшее"] },
      { id: 92, name: "Удалённый юрист", category: "юриспруденция", keywords: ["юрист", "договор", "право", "закон", "удалённо", "консультация", "документы"], weight: 0.94, context: ["гибкий график", "высшее", "город"] },
      { id: 93, name: "Удалённый аналитик", category: "IT", keywords: ["аналитик", "данные", "удалённо", "excel", "sql", "отчёты", "база"], weight: 0.9, context: ["наука", "удалёнка", "высшее"] },
      { id: 94, name: "Медсестра в детском саду", category: "медицина", keywords: ["медсестра", "детский сад", "вакцина", "температура", "уход", "дети", "здоровье"], weight: 0.87, context: ["помощь", "семья", "город"] },
      { id: 95, name: "Ландшафтный дизайнер", category: "дизайн", keywords: ["ландшафт", "сад", "дизайн", "цветы", "деревья", "уход", "на свежем воздухе"], weight: 0.8, context: ["на свежем воздухе", "низкое образование", "город"] },
      { id: 96, name: "Работник лесхоза", category: "сельхоз", keywords: ["лес", "лесхоз", "лесопилка", "лесные работы", "экология", "на свежем воздухе", "работа на природе"], weight: 0.86, context: ["на свежем воздухе", "высшее", "город"] },
      { id: 97, name: "Работник сельхозпредприятия", category: "сельхоз", keywords: ["сельхоз", "ферма", "животные", "посадка", "уборка", "трактор", "сельское хозяйство"], weight: 0.88, context: ["на свежем воздухе", "спо", "село"] },
      { id: 98, name: "Удалённый переводчик", category: "услуги", keywords: ["переводчик", "удалённо", "английский", "текст", "документ", "перевод", "язык"], weight: 0.91, context: ["тишина", "высшее", "удалёнка"] },
      { id: 99, name: "Фриланс-иллюстратор", category: "дизайн", keywords: ["иллюстрация", "фриланс", "рисунок", "стиль", "персонаж", "картина", "творчество"], weight: 0.89, context: ["тишина", "творчество", "удалёнка"] },
      { id: 100, name: "Психолог в детском саду", category: "образование", keywords: ["психолог", "детский сад", "дети", "поведение", "консультация", "поддержка", "семья"], weight: 0.88, context: ["помощь", "тишина", "город"] },
      { id: 101, name: "Фриланс-дизайнер", category: "дизайн", keywords: ["дизайн", "фриланс", "графика", "фотошоп", "иллюстратор", "веб", "логотип"], weight: 0.92, context: ["творчество", "удалёнка", "высшее"] },
      { id: 102, name: "Фриланс-художник", category: "дизайн", keywords: ["художник", "фриланс", "картина", "акварель", "рисунок", "живопись", "творчество"], weight: 0.85, context: ["творчество", "село", "высшее"] },
      { id: 103, name: "Удалённый юрист", category: "юриспруденция", keywords: ["юрист", "договор", "право", "закон", "удалённо", "консультация", "документы"], weight: 0.94, context: ["гибкий график", "высшее", "город"] },
      { id: 104, name: "Удалённый аналитик", category: "IT", keywords: ["аналитик", "данные", "удалённо", "excel", "sql", "отчёты", "база"], weight: 0.9, context: ["наука", "удалёнка", "высшее"] },
      { id: 105, name: "Медсестра в детском саду", category: "медицина", keywords: ["медсестра", "детский сад", "вакцина", "температура", "уход", "дети", "здоровье"], weight: 0.87, context: ["помощь", "семья", "город"] },
      { id: 106, name: "Ландшафтный дизайнер", category: "дизайн", keywords: ["ландшафт", "сад", "дизайн", "цветы", "деревья", "уход", "на свежем воздухе"], weight: 0.8, context: ["на свежем воздухе", "низкое образование", "город"] },
      { id: 107, name: "Работник лесхоза", category: "сельхоз", keywords: ["лес", "лесхоз", "лесопилка", "лесные работы", "экология", "на свежем воздухе", "работа на природе"], weight: 0.86, context: ["на свежем воздухе", "высшее", "город"] },
      { id: 108, name: "Работник сельхозпредприятия", category: "сельхоз", keywords: ["сельхоз", "ферма", "животные", "посадка", "уборка", "трактор", "сельское хозяйство"], weight: 0.88, context: ["на свежем воздухе", "спо", "село"] },
      { id: 109, name: "Удалённый переводчик", category: "услуги", keywords: ["переводчик", "удалённо", "английский", "текст", "документ", "перевод", "язык"], weight: 0.91, context: ["тишина", "высшее", "удалёнка"] },
      { id: 110, name: "Фриланс-иллюстратор", category: "дизайн", keywords: ["иллюстрация", "фриланс", "рисунок", "стиль", "персонаж", "картина", "творчество"], weight: 0.89, context: ["тишина", "творчество", "удалёнка"] },
      { id: 111, name: "Психолог в детском саду", category: "образование", keywords: ["психолог", "детский сад", "дети", "поведение", "консультация", "поддержка", "семья"], weight: 0.88, context: ["помощь", "тишина", "город"] },
      { id: 112, name: "Фриланс-дизайнер", category: "дизайн", keywords: ["дизайн", "фриланс", "графика", "фотошоп", "иллюстратор", "веб", "логотип"], weight: 0.92, context: ["творчество", "удалёнка", "высшее"] },
      { id: 113, name: "Фриланс-художник", category: "дизайн", keywords: ["художник", "фриланс", "картина", "акварель", "рисунок", "живопись", "творчество"], weight: 0.85, context: ["творчество", "село", "высшее"] },
      { id: 114, name: "Удалённый юрист", category: "юриспруденция", keywords: ["юрист", "договор", "право", "закон", "удалённо", "консультация", "документы"], weight: 0.94, context: ["гибкий график", "высшее", "город"] },
      { id: 115, name: "Удалённый аналитик", category: "IT", keywords: ["аналитик", "данные", "удалённо", "excel", "sql", "отчёты", "база"], weight: 0.9, context: ["наука", "удалёнка", "высшее"] },
      { id: 116, name: "Медсестра в детском саду", category: "медицина", keywords: ["медсестра", "детский сад", "вакцина", "температура", "уход", "дети", "здоровье"], weight: 0.87, context: ["помощь", "семья", "город"] },
      { id: 117, name: "Ландшафтный дизайнер", category: "дизайн", keywords: ["ландшафт", "сад", "дизайн", "цветы", "деревья", "уход", "на свежем воздухе"], weight: 0.8, context: ["на свежем воздухе", "низкое образование", "город"] },
      { id: 118, name: "Работник лесхоза", category: "сельхоз", keywords: ["лес", "лесхоз", "лесопилка", "лесные работы", "экология", "на свежем воздухе", "работа на природе"], weight: 0.86, context: ["на свежем воздухе", "высшее", "город"] },
      { id: 119, name: "Работник сельхозпредприятия", category: "сельхоз", keywords: ["сельхоз", "ферма", "животные", "посадка", "уборка", "трактор", "сельское хозяйство"], weight: 0.88, context: ["на свежем воздухе", "спо", "село"] },
      { id: 120, name: "Удалённый переводчик", category: "услуги", keywords: ["переводчик", "удалённо", "английский", "текст", "документ", "перевод", "язык"], weight: 0.91, context: ["тишина", "высшее", "удалёнка"] },
      { id: 121, name: "Фриланс-иллюстратор", category: "дизайн", keywords: ["иллюстрация", "фриланс", "рисунок", "стиль", "персонаж", "картина", "творчество"], weight: 0.89, context: ["тишина", "творчество", "удалёнка"] },
      { id: 122, name: "Психолог в детском саду", category: "образование", keywords: ["психолог", "детский сад", "дети", "поведение", "консультация", "поддержка", "семья"], weight: 0.88, context: ["помощь", "тишина", "город"] },
      { id: 123, name: "Фриланс-дизайнер", category: "дизайн", keywords: ["дизайн", "фриланс", "графика", "фотошоп", "иллюстратор", "веб", "логотип"], weight: 0.92, context: ["творчество", "удалёнка", "высшее"] },
      { id: 124, name: "Фриланс-художник", category: "дизайн", keywords: ["художник", "фриланс", "картина", "акварель", "рисунок", "живопись", "творчество"], weight: 0.85, context: ["творчество", "село", "высшее"] },
      { id: 125, name: "Удалённый юрист", category: "юриспруденция", keywords: ["юрист", "договор", "право", "закон", "удалённо", "консультация", "документы"], weight: 0.94, context: ["гибкий график", "высшее", "город"] },
      { id: 126, name: "Удалённый аналитик", category: "IT", keywords: ["аналитик", "данные", "удалённо", "excel", "sql", "отчёты", "база"], weight: 0.9, context: ["наука", "удалёнка", "высшее"] },
      { id: 127, name: "Медсестра в детском саду", category: "медицина", keywords: ["медсестра", "детский сад", "вакцина", "температура", "уход", "дети", "здоровье"], weight: 0.87, context: ["помощь", "семья", "город"] },
      { id: 128, name: "Ландшафтный дизайнер", category: "дизайн", keywords: ["ландшафт", "сад", "дизайн", "цветы", "деревья", "уход", "на свежем воздухе"], weight: 0.8, context: ["на свежем воздухе", "низкое образование", "город"] },
      { id: 129, name: "Работник лесхоза", category: "сельхоз", keywords: ["лес", "лесхоз", "лесопилка", "лесные работы", "экология", "на свежем воздухе", "работа на природе"], weight: 0.86, context: ["на свежем воздухе", "высшее", "город"] },
      { id: 130, name: "Работник сельхозпредприятия", category: "сельхоз", keywords: ["сельхоз", "ферма", "животные", "посадка", "уборка", "трактор", "сельское хозяйство"], weight: 0.88, context: ["на свежем воздухе", "спо", "село"] },
      { id: 131, name: "Удалённый переводчик", category: "услуги", keywords: ["переводчик", "удалённо", "английский", "текст", "документ", "перевод", "язык"], weight: 0.91, context: ["тишина", "высшее", "удалёнка"] },
      { id: 132, name: "Фриланс-иллюстратор", category: "дизайн", keywords: ["иллюстрация", "фриланс", "рисунок", "стиль", "персонаж", "картина", "творчество"], weight: 0.89, context: ["тишина", "творчество", "удалёнка"] },
      { id: 133, name: "Психолог в детском саду", category: "образование", keywords: ["психолог", "детский сад", "дети", "поведение", "консультация", "поддержка", "семья"], weight: 0.88, context: ["помощь", "тишина", "город"] },
      { id: 134, name: "Фриланс-дизайнер", category: "дизайн", keywords: ["дизайн", "фриланс", "графика", "фотошоп", "иллюстратор", "веб", "логотип"], weight: 0.92, context: ["творчество", "удалёнка", "высшее"] },
      { id: 135, name: "Фриланс-художник", category: "дизайн", keywords: ["художник", "фриланс", "картина", "акварель", "рисунок", "живопись", "творчество"], weight: 0.85, context: ["творчество", "село", "высшее"] },
      { id: 136, name: "Удалённый юрист", category: "юриспруденция", keywords: ["юрист", "договор", "право", "закон", "удалённо", "консультация", "документы"], weight: 0.94, context: ["гибкий график", "высшее", "город"] },
      { id: 137, name: "Удалённый аналитик", category: "IT", keywords: ["аналитик", "данные", "удалённо", "excel", "sql", "отчёты", "база"], weight: 0.9, context: ["наука", "удалёнка", "высшее"] },
      { id: 138, name: "Медсестра в детском саду", category: "медицина", keywords: ["медсестра", "детский сад", "вакцина", "температура", "уход", "дети", "здоровье"], weight: 0.87, context: ["помощь", "семья", "город"] },
      { id: 139, name: "Ландшафтный дизайнер", category: "дизайн", keywords: ["ландшафт", "сад", "дизайн", "цветы", "деревья", "уход", "на свежем воздухе"], weight: 0.8, context: ["на свежем воздухе", "низкое образование", "город"] },
      { id: 140, name: "Работник лесхоза", category: "сельхоз", keywords: ["лес", "лесхоз", "лесопилка", "лесные работы", "экология", "на свежем воздухе", "работа на природе"], weight: 0.86, context: ["на свежем воздухе", "высшее", "город"] },
      { id: 141, name: "Работник сельхозпредприятия", category: "сельхоз", keywords: ["сельхоз", "ферма", "животные", "посадка", "уборка", "трактор", "сельское хозяйство"], weight: 0.88, context: ["на свежем воздухе", "спо", "село"] },
      { id: 142, name: "Удалённый переводчик", category: "услуги", keywords: ["переводчик", "удалённо", "английский", "текст", "документ", "перевод", "язык"], weight: 0.91, context: ["тишина", "высшее", "удалёнка"] },
      { id: 143, name: "Фриланс-иллюстратор", category: "дизайн", keywords: ["иллюстрация", "фриланс", "рисунок", "стиль", "персонаж", "картина", "творчество"], weight: 0.89, context: ["тишина", "творчество", "удалёнка"] },
      { id: 144, name: "Психолог в детском саду", category: "образование", keywords: ["психолог", "детский сад", "дети", "поведение", "консультация", "поддержка", "семья"], weight: 0.88, context: ["помощь", "тишина", "город"] },
      { id: 145, name: "Фриланс-дизайнер", category: "дизайн", keywords: ["дизайн", "фриланс", "графика", "фотошоп", "иллюстратор", "веб", "логотип"], weight: 0.92, context: ["творчество", "удалёнка", "высшее"] },
      { id: 146, name: "Фриланс-художник", category: "дизайн", keywords: ["художник", "фриланс", "картина", "акварель", "рисунок", "живопись", "творчество"], weight: 0.85, context: ["творчество", "село", "высшее"] },
      { id: 147, name: "Удалённый юрист", category: "юриспруденция", keywords: ["юрист", "договор", "право", "закон", "удалённо", "консультация", "документы"], weight: 0.94, context: ["гибкий график", "высшее", "город"] },
      { id: 148, name: "Удалённый аналитик", category: "IT", keywords: ["аналитик", "данные", "удалённо", "excel", "sql", "отчёты", "база"], weight: 0.9, context: ["наука", "удалёнка", "высшее"] },
      { id: 149, name: "Медсестра в детском саду", category: "медицина", keywords: ["медсестра", "детский сад", "вакцина", "температура", "уход", "дети", "здоровье"], weight: 0.87, context: ["помощь", "семья", "город"] }
    ];

    // 2. Токенизация и нормализация
    function tokenize(text) {
      if (!text) return [];
      return text
        .toLowerCase()
        .replace(/[.,!?;:()"'`]/g, ' ')
        .split(/\s+/)
        .filter(word => word.length > 2 && word.length < 20);
    }

    // 3. Извлечение признаков (Н-мерный вектор)

        function extractFeatures(text) {
            const tokens = tokenize(text);
            const features = new Array(24).fill(0);

            // === 1-2: Образование ===
            features[0] = tokens.some(t => ["высшее", "университет", "институт", "магистр", "бакалавр"].includes(t)) ? 1 : 0;
            features[1] = tokens.some(t => ["спо", "колледж", "техникум", "училище"].includes(t)) ? 1 : 0;

            // === 3-4: Опыт ===
            features[2] = tokens.some(t => ["опыт", "работа", "стаж", "практика", "работал", "работала"].includes(t)) ? 1 : 0;
            features[3] = tokens.some(t => ["новичок", "без опыта", "студент", "учусь"].includes(t)) ? 1 : 0;

            // === 5-6: Место жительства ===
            features[4] = tokens.some(t => ["город", "москва", "питер", "екатеринбург", "новосибирск", "казань", "самара", "ростов"].includes(t)) ? 1 : 0;
            features[5] = tokens.some(t => ["село", "деревня", "посёлок", "сельская", "область", "региональный"].includes(t)) ? 1 : 0;

            // === 7-8: Режим работы ===
            features[6] = tokens.some(t => ["удалённо", "удалёнка", "дистанционно", "онлайн", "дома", "из дома"].includes(t)) ? 1 : 0;
            features[7] = tokens.some(t => ["офис", "компания", "на месте", "в офисе"].includes(t)) ? 1 : 0;

            // === 9-10: Психотип ===
            features[8] = tokens.some(t => ["экстраверт", "общительный", "общается", "говорливый", "предприниматель"].includes(t)) ? 1 : 0;
            features[9] = tokens.some(t => ["интроверт", "тихий", "закрытый", "молчаливый", "не люблю шум"].includes(t)) ? 1 : 0;

            // === 11-12: Социальные/эмоциональные ===
            features[10] = tokens.some(t => ["помощь", "поддержка", "консультация", "воспитание", "уход", "лечение"].includes(t)) ? 1 : 0;
            features[11] = tokens.some(t => ["творчество", "рисунок", "дизайн", "фото", "арт", "музыка", "писатель", "художник"].includes(t)) ? 1 : 0;

            // === 13-14: Финансы ===
            features[12] = tokens.some(t => ["высокая зарплата", "деньги", "богатый", "доход", "зарплата", "оклад", "доходы"].includes(t)) ? 1 : 0;
            features[13] = tokens.some(t => ["низкая зарплата", "премия", "доплата", "субсидия", "помощь", "соцподдержка"].includes(t)) ? 1 : 0;

            // === 15-16: Семья/здоровье ===
            features[14] = tokens.some(t => ["семья", "дети", "ребёнок", "жена", "муж", "семейный", "домашний"].includes(t)) ? 1 : 0;
            features[15] = tokens.some(t => ["ограничения", "болезнь", "инвалид", "хронический", "здоровье", "проблемы", "ограничен"].includes(t)) ? 1 : 0;

            // === НОВЫЕ ПРИЗНАКИ (24-16 = 8 новых) ===

            // 17: Возраст (20-30 лет → 1, 31-40 → 0.5, 41+ → 0) — числовая оценка
            const ageMatch = text.match(/мне\s+(\d+)\s+лет/);
            if (ageMatch) {
                const age = parseInt(ageMatch[1]);
                features[16] = age >= 20 && age <= 30 ? 1 : age >= 31 && age <= 40 ? 0.5 : 0;
            }

            // 18: Семейное положение — "один", "не женат", "не замужем" → 1
            features[17] = tokens.some(t => ["один", "не женат", "не замужем", "холост", "холостая"].includes(t)) ? 1 : 0;

            // 19: Количество лет опыта — ищем "X лет" рядом с "опыт", "работа", "стаж"
            const yearsMatch = text.match(/(\d+)\s+(лет|года|года?)/);
            const hasExperience = tokens.some(t => ["опыт", "работа", "стаж", "работал", "работала"].includes(t));
            if (yearsMatch && hasExperience) {
                const years = parseInt(yearsMatch[1]);
                features[18] = Math.min(years / 10, 1); // нормализуем до [0,1] — до 10 лет
            }

            // 20: Упоминание конкретного вуза — МГУ, МГИМО, МГТУ и т.д. → 1
            features[19] = tokens.some(t => ["мгу", "мгимо", "мгту", "спбгу", "мфти", "вшэ", "рэу", "рту", "мглгу"].includes(t)) ? 1 : 0;

            // 21: Упоминание 1С — сильный признак для бухгалтерии
            features[20] = tokens.some(t => ["1с", "1с:предприятие", "1с бухгалтерия", "1с:бухгалтерия"].includes(t)) ? 1 : 0;

            // 22: Упоминание "не люблю шум" → усиливаем "интроверт"
            features[21] = text.includes("не люблю шум") || text.includes("не люблю шумные") ? 1 : 0;

            // 23: Упоминание "график 5/2" → укрепляет "удалёнка" и "стабильность"
            features[22] = text.includes("график 5/2") || text.includes("пять два") ? 1 : 0;

            // 24: Упоминание "стабильный", "спокойный", "без стресса" → усиливает "не офис", "удалёнка"
            features[23] = tokens.some(t => ["спокойный", "стабильный", "без стресса", "не стресс", "спокойная работа"].includes(t)) ? 1 : 0;

            return features;
        }


    // ===============================
    // 4. Генерация синтетических резюме (1000+ примеров)
    // ===============================
    function generateSyntheticResumes(num = 1000) {
      const resumes = [];
      const contexts = [
        "высшее", "спо", "низкое образование", "молодой", "семья", "город", "село", "удалёнка", "на свежем воздухе",
        "помощь", "творчество", "высокая зарплата", "ограничения", "экстраверт", "интроверт"
      ];

      const templates = [
        "Я окончил {education} и имею опыт работы в {job}. Хочу {preference}. Живу в {location}.",
        "Работал {job} {years} года. Владею {skill}. Предпочитаю {preference}. {location}.",
        "Ищу {job}. У меня {education}. Люблю {preference}. Не люблю {avoid}. Живу в {location}.",
        "У меня {education}. Опыт в {job}. Хочу работать {preference}. Моя цель — {goal}.",
        "Я {education}, {age}. Работал в {job}. Хочу {preference}. {location}."
      ];

      const jobNames = jobs.map(j => j.name);
      const skills = ["1С", "Excel", "SQL", "Figma", "Python", "Power BI", "Word", "Photoshop", "Google Analytics", "CRM"];
      const locations = ["Москва", "Санкт-Петербург", "Екатеринбург", "Новосибирск", "Казань", "Самара", "Ростов", "Волгоград", "Село", "Деревня"];
      const ages = ["молодой", "среднего возраста", "пожилой"];
      const years = ["1", "2", "3", "5", "7", "10"];

      for (let i = 0; i < num; i++) {
        const job = jobNames[Math.floor(Math.random() * jobNames.length)];
        const jobObj = jobs.find(j => j.name === job);
        const template = templates[Math.floor(Math.random() * templates.length)];
        const education = ["высшее", "спо", "низкое образование"][Math.floor(Math.random() * 3)];
        const preference = contexts[Math.floor(Math.random() * contexts.length)];
        const location = locations[Math.floor(Math.random() * locations.length)];
        const skill = skills[Math.floor(Math.random() * skills.length)];
        const avoid = contexts[Math.floor(Math.random() * contexts.length)];
        const goal = contexts[Math.floor(Math.random() * contexts.length)];
        const age = ages[Math.floor(Math.random() * ages.length)];
        const year = years[Math.floor(Math.random() * years.length)];

        let resumeText = template
          .replace("{job}", job)
          .replace("{education}", education)
          .replace("{preference}", preference)
          .replace("{location}", location)
          .replace("{skill}", skill)
          .replace("{avoid}", avoid)
          .replace("{goal}", goal)
          .replace("{age}", age)
          .replace("{years}", year);

        resumes.push({
          text: resumeText,
          target: jobObj.id
        });
      }

      return resumes;
    }

    // ===============================
    // 5. Нейросеть: Многослойный персептрон (MLP) с обратным распространением
    // ===============================
    class MLP {
      constructor(inputSize, hiddenSize1, hiddenSize2, outputSize, learningRate = 0.01) {
        this.inputSize = inputSize;
        this.hiddenSize1 = hiddenSize1;
        this.hiddenSize2 = hiddenSize2;
        this.outputSize = outputSize;
        this.lr = learningRate;

        // Инициализация весов (Xavier)
        this.weights1 = this.xavierInit(inputSize, hiddenSize1);
        this.biases1 = new Array(hiddenSize1).fill(0);
        this.weights2 = this.xavierInit(hiddenSize1, hiddenSize2);
        this.biases2 = new Array(hiddenSize2).fill(0);
        this.weights3 = this.xavierInit(hiddenSize2, outputSize);
        this.biases3 = new Array(outputSize).fill(0);
      }

      xavierInit(rows, cols) {
        const limit = Math.sqrt(6 / (rows + cols));
        const weights = [];
        for (let i = 0; i < rows; i++) {
          weights[i] = [];
          for (let j = 0; j < cols; j++) {
            weights[i][j] = (Math.random() - 0.5) * 2 * limit;
          }
        }
        return weights;
      }

      sigmoid(x) {
        return 1 / (1 + Math.exp(-x));
      }

      sigmoidDerivative(x) {
        return x * (1 - x);
      }

      feedForward(input) {
        // Слой 1
        let hidden1 = new Array(this.hiddenSize1).fill(0);
        for (let j = 0; j < this.hiddenSize1; j++) {
          for (let i = 0; i < input.length; i++) {
            hidden1[j] += input[i] * this.weights1[i][j];
          }
          hidden1[j] = this.sigmoid(hidden1[j] + this.biases1[j]);
        }

        // Слой 2
        let hidden2 = new Array(this.hiddenSize2).fill(0);
        for (let j = 0; j < this.hiddenSize2; j++) {
          for (let i = 0; i < hidden1.length; i++) {
            hidden2[j] += hidden1[i] * this.weights2[i][j];
          }
          hidden2[j] = this.sigmoid(hidden2[j] + this.biases2[j]);
        }

        // Выходной слой
        let output = new Array(this.outputSize).fill(0);
        for (let j = 0; j < this.outputSize; j++) {
          for (let i = 0; i < hidden2.length; i++) {
            output[j] += hidden2[i] * this.weights3[i][j];
          }
          output[j] = this.sigmoid(output[j] + this.biases3[j]);
        }

        return {
          input: input,
          hidden1,
          hidden2,
          output
        };
      }

      train(input, target, epochs = 100) {
        for (let epoch = 0; epoch < epochs; epoch++) {
          let totalLoss = 0;
          let correct = 0;

          for (let i = 0; i < input.length; i++) {
            const output = this.feedForward(input[i]);

            // Вычисление ошибки (MSE)
            let loss = 0;
            for (let j = 0; j < this.outputSize; j++) {
              const err = target[i][j] - output.output[j];
              loss += err * err;
              // Градиенты для backprop
              const deltaOutput = err * this.sigmoidDerivative(output.output[j]);

              // Обновление весов 3-го слоя
              for (let k = 0; k < this.hiddenSize2; k++) {
                this.weights3[k][j] += this.lr * deltaOutput * output.hidden2[k];
              }
              this.biases3[j] += this.lr * deltaOutput;
            }
            totalLoss += loss;

            // Backprop через слой 2
            const deltaHidden2 = new Array(this.hiddenSize2).fill(0);
            for (let j = 0; j < this.hiddenSize2; j++) {
              let sum = 0;
              for (let k = 0; k < this.outputSize; k++) {
                const err = target[i][k] - output.output[k];
                const deltaOutput = err * this.sigmoidDerivative(output.output[k]);
                sum += deltaOutput * this.weights3[j][k];
              }
              deltaHidden2[j] = sum * this.sigmoidDerivative(output.hidden2[j]);

              // Обновление весов 2-го слоя
              for (let k = 0; k < this.hiddenSize1; k++) {
                this.weights2[k][j] += this.lr * deltaHidden2[j] * output.hidden1[k];
              }
              this.biases2[j] += this.lr * deltaHidden2[j];
            }

            // Backprop через слой 1
            const deltaHidden1 = new Array(this.hiddenSize1).fill(0);
            for (let j = 0; j < this.hiddenSize1; j++) {
              let sum = 0;
              for (let k = 0; k < this.hiddenSize2; k++) {
                sum += deltaHidden2[k] * this.weights2[j][k];
              }
              deltaHidden1[j] = sum * this.sigmoidDerivative(output.hidden1[j]);

              // Обновление весов 1-го слоя
              for (let k = 0; k < this.inputSize; k++) {
                this.weights1[k][j] += this.lr * deltaHidden1[j] * input[i][k];
              }
              this.biases1[j] += this.lr * deltaHidden1[j];
            }

            // Подсчёт точности
            const predicted = output.output.indexOf(Math.max(...output.output));
            const actual = target[i].indexOf(1);
            if (predicted === actual) correct++;
          }

          const accuracy = (correct / input.length) * 100;
          const avgLoss = totalLoss / input.length;

          // Обновляем прогресс
          document.getElementById("trainingProgress").innerHTML = `
            <div class="epoch">Эпоха ${epoch + 1}/${epochs} | Loss: ${avgLoss.toFixed(4)} | Точность: ${accuracy.toFixed(2)}%</div>
          `;
        }

        // Сохраняем модель
        this.saveModel();
        document.getElementById("trainingProgress").innerHTML += `<div class="status">Обучение завершено!</div>`;
      }

      predict(input) {
        const result = this.feedForward(input);
        return result.output;
      }

      predictWithActivations(input) {
        return this.feedForward(input);
      }

      saveModel() {
        const model = {
          weights1: this.weights1,
          biases1: this.biases1,
          weights2: this.weights2,
          biases2: this.biases2,
          weights3: this.weights3,
          biases3: this.biases3
        };
        localStorage.setItem("nlpJobModel", JSON.stringify(model));
      }

      loadModel() {
        const saved = localStorage.getItem("nlpJobModel");
        if (!saved) return false;
        const model = JSON.parse(saved);
        this.weights1 = model.weights1;
        this.biases1 = model.biases1;
        this.weights2 = model.weights2;
        this.biases2 = model.biases2;
        this.weights3 = model.weights3;
        this.biases3 = model.biases3;
        return true;
      }
    }

    // ===============================
    // 6. Инициализация модели
        // ===============================

    const nn = new MLP(24, 32, 16, jobs.length, 0.01);


    // Загружаем сохранённую модель
    if (nn.loadModel()) {
      document.getElementById("trainingProgress").innerHTML = "<div class='status'>Модель загружена из localStorage</div>";
    }

    // ===============================
    // 7. Функция визуализации тепловой карты
    // ===============================
    function renderHeatmap(containerId, values, label) {
      const container = document.getElementById(containerId);
      container.innerHTML = ''; // Очистить

      const maxValue = Math.max(...values);
      const minValue = Math.min(...values);

      values.forEach((val, idx) => {
        const cell = document.createElement('div');
        cell.className = 'heatmap-cell';

        // Нормализуем значение в диапазоне 0–1
        const normalized = maxValue === minValue ? 0.5 : (val - minValue) / (maxValue - minValue);

        // Цветовая шкала: синий → белый → красный
        let r, g, b;
        if (normalized < 0.5) {
          // Синий → белый
          const t = normalized * 2;
          r = 255 * t;
          g = 255 * t;
          b = 255 - 255 * t;
        } else {
          // Белый → красный
          const t = (normalized - 0.5) * 2;
          r = 255;
          g = 255 * (1 - t);
          b = 255 * (1 - t);
        }

        cell.style.backgroundColor = `rgb(${Math.round(r)}, ${Math.round(g)}, ${Math.round(b)})`;
        cell.title = `${label} #${idx}: ${val.toFixed(3)}`;
        container.appendChild(cell);
      });
    }

    // ===============================
    // 8. Основные функции
    // ===============================
    async function trainModel() {
      const progressDiv = document.getElementById("trainingProgress");
      progressDiv.innerHTML = "<div class='epoch'>🔄 Генерация данных...</div>";

      const syntheticData = generateSyntheticResumes(1000);
      const inputs = syntheticData.map(d => extractFeatures(d.text));
      const targets = syntheticData.map(d => {
        const t = new Array(jobs.length).fill(0);
        t[d.target] = 1;
        return t;
      });

      progressDiv.innerHTML = "<div class='epoch'>Обучение модели (10 эпох)...</div>";
      nn.train(inputs, targets, 10); // 10 эпох
    }

    function clearModel() {
      localStorage.removeItem("nlpJobModel");
      alert("Модель сброшена. Нажмите 'Обучить', чтобы начать заново.");
      document.getElementById("trainingProgress").innerHTML = "<div class='epoch'>Готово. Нажмите 'Обучить', чтобы начать.</div>";
    }

    function analyzeResume() {
      const text = document.getElementById("resume").value.trim();
      if (!text) {
        alert("Пожалуйста, введите ваше резюме.");
        return;
      }

      const features = extractFeatures(text);

      // Получаем активации всех слоёв
      const activations = nn.predictWithActivations(features);

      // Визуализируем тепловые карты
      renderHeatmap("inputHeatmap", activations.input, "Вход");
      renderHeatmap("hidden1Heatmap", activations.hidden1, "Слой 1");
      renderHeatmap("hidden2Heatmap", activations.hidden2, "Слой 2");
      renderHeatmap("outputHeatmap", activations.output, "Выход");

      // Ранжируем рекомендации
      const scores = activations.output;
      const ranked = jobs.map((job, idx) => ({
        name: job.name,
        score: scores[idx],
        weight: job.weight,
        reason: job.keywords.join(", ") + " | " + job.context.join(", ")
      })).sort((a, b) => b.score - a.score).slice(0, 5);

      const resultsDiv = document.getElementById("results");
      resultsDiv.innerHTML = "<h3>Рекомендации:</h3>";

      ranked.forEach(job => {
        const div = document.createElement("div");
        div.className = "recommendation";
        div.innerHTML = `
          <strong>${job.name}</strong>
          <div class="score">Вероятность: ${(job.score * 100).toFixed(1)}%</div>
          <div class="reason">${job.reason}</div>
        `;
        resultsDiv.appendChild(div);
      });
        }



        // === 1. ОПРЕДЕЛИМ РЕЗЮМЕ ===
        const resumes = [
            "Я окончил высшее образование в МГУ, владею 1С, ищу удалённую работу в IT, нужна стабильная зарплата, не люблю командировки, хочу учиться новому, знаю английский.",
            "Опыт работы в IT 5 лет, специализация — разработка на Python и JavaScript, работал в офисе, готов к командировкам, хочу расти, изучаю английский.",
            "Высшее образование, опыт в 1С, хочу удалёнку, зарплата важна, не хочу переработок, люблю спокойную команду, английский на уровне B1."
        ];

        const query = "Ищу удалённую работу в IT с хорошей зарплатой и возможностью учиться";

        // === 2. ЗАГРУЖАЕМ МОДЕЛЬ ===
        async function loadModel() {
            console.log("Загрузка модели Universal Sentence Encoder...");
            const model = await universalSentenceEncoder.load();
            console.log("Модель загружена!");
            return model;
        }

        // === 3. ПОЛУЧАЕМ ЭМБЕДДИНГИ ===
        async function getEmbeddings(model, texts) {
            const embeddings = await model.embed(texts);
            return embeddings.arraySync(); // превращаем в обычный массив
        }

        // === 4. СРАВНИВАЕМ ВЕКТОРЫ (косинусное сходство) ===
        function cosineSimilarity(vecA, vecB) {
            const dotProduct = vecA.reduce((sum, a, i) => sum + a * vecB[i], 0);
            const normA = Math.sqrt(vecA.reduce((sum, a) => sum + a * a, 0));
            const normB = Math.sqrt(vecB.reduce((sum, b) => sum + b * b, 0));
            return dotProduct / (normA * normB);
        }

        // === 5. ОСНОВНАЯ ЛОГИКА ===
        async function analyzeResumes() {
            const model = await loadModel();

            // Получаем эмбеддинги для всех резюме и запроса
            const allTexts = [...resumes, query];
            const embeddings = await getEmbeddings(model, allTexts);

            const queryEmbedding = embeddings[embeddings.length - 1]; // последний — запрос
            const resumeEmbeddings = embeddings.slice(0, resumes.length);

            // Сравниваем запрос с каждым резюме
            const similarities = resumeEmbeddings.map((resumeVec, idx) => ({
                index: idx + 1,
                similarity: cosineSimilarity(queryEmbedding, resumeVec),
                text: resumes[idx]
            }));

            // Сортируем по сходству (по убыванию)
            similarities.sort((a, b) => b.similarity - a.similarity);

            // Выводим результаты
            console.log("\n=== РЕЗУЛЬТАТЫ СРАВНЕНИЯ ===");
            similarities.forEach(item => {
                console.log(`\n🔹 Резюме ${item.index}: ${item.similarity.toFixed(4)}`);
                console.log(`   "${item.text.slice(0, 100)}... "`);
            });

            // Лучший кандидат
            const best = similarities[0];
            console.log(`\n🏆 ЛУЧШИЙ КАНДИДАТ: Резюме ${best.index} (сходство: ${best.similarity.toFixed(4)})`);
        }

        // Запускаем
        analyzeResumes().catch(console.error);


    </script>
</body>
</html>
